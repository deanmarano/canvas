(function() {

  window.LineCanvas = (function() {

    function LineCanvas() {
      this.canvas = document.getElementById("lineCanvas");
      this.context = this.canvas.getContext('2d');
      this.imgFunctions = new App.Lib.ImageFunctions(this.context);
    }

    LineCanvas.prototype.showImage = function(image) {
      this.lastFoundCharacter = 0;
      this.image = image;
      return this.writeImage();
    };

    LineCanvas.prototype.writeImage = function() {
      this.canvas.width = this.image.width();
      this.canvas.height = this.image.height();
      return this.context.putImageData(this.image.imageData, 0, 0);
    };

    LineCanvas.prototype.segmentVertical = function() {
      var imageToWrite;
      imageToWrite = this.cloneImage(this.image);
      this.image = this.imgFunctions.segmentVertical(this.image, imageToWrite);
      return this.writeImage();
    };

    LineCanvas.prototype.cloneImage = function(sourceImage) {
      var imageData;
      imageData = this.context.createImageData(sourceImage.width(), sourceImage.height());
      imageData.data.set(sourceImage.data());
      return new App.Models.ImageData(imageData);
    };

    LineCanvas.prototype.findNextCharacter = function() {
      var column, left, right;
      column = this.lastFoundCharacter || 0;
      while (this.image.getPixel(0, column).red === 0) {
        column = column + 1;
      }
      left = column;
      while (this.image.getPixel(0, column).red !== 0) {
        column = column + 1;
      }
      right = column;
      this.lastFoundCharacter = right;
      return this.imgFunctions.getSegment(this.image, 0, left, this.image.height(), right);
    };

    return LineCanvas;

  })();

}).call(this);
